language: node_js
node_js:
  - "12.13.0"
os:
  - linux
  - osx

osx_image: xcode10.2

sudo: required

cache:
  directories:
    - node_modules

addons:
  apt:
    packages:
      - graphicsmagick
      - icnsutils
      - gcc-multilib
      - g++-multilib
      - bsdtar
      - rpm
      - xz-utils

before_install:
  - node --version
  - npm install electron@10.1.1
  - npm install electron-builder@22.8.0
  - npm install -g yarn

install:
  - npm install
  - pushd ccurl
  - rm mac/libccurl.dylib
  - rm lin64/libccurl.so
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then
    echo "in linux";
    gcc -shared -o libccurl.so libccurl.cpp -O3 -lpthread -fPIC -std=c++11;
    mkdir -p lin64;
    cp libccurl.so lin64/;
    rm libccurl.so;
    fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
    echo "in osx";
    gcc -dynamiclib -o libccurl.dylib libccurl.cpp -O3 -lpthread -std=c++11;
    mkdir -p mac;
    cp libccurl.dylib mac/;
    rm libccurl.dylib;
    fi
  - popd
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then  npm run publish:lin; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then  npm run publish:mac; fi
  - find out

script:
  - echo "nothing to do"

deploy:
  - provider: releases
    api_key:
      secure: gZLVdbpEIbwPUSB6VRiqIczneke8J2P3RCAezeiSaYv15cXzZ5iX1Sd/o4LSu3YCKKhW9Qt8x0ZMHu9tw2+x8K7gjsBBidJvDwvzlDaiaJ57focGwhUPghg5qtElTverS6tC+oRJ67+coOvVI9iquNOKsdClMUZeOSlEDycxmT3f2SCyC3jLfGthcgrN08cw86L/w9dnoz6iE1E0EnUqs3fNsAb/ggqPXnwbTSQwIHJIgzep4k4jpqpgQOgcrs7MbhPoyxTpEPZwEOEVHIhFYImlUP/0iFJky5QqLOICPrVJ9gFRJQE3Om5Im8xZAvCcRUCkuzjSnit8x3kJz/hlavmHdTkNB1ALzmHGIpGI5frbzDF3vyJGJwG0OuAuKiY7VnyS44qin0JusPfOVgCSFLpTrYBO/pp7T0yjbZY8JUxp2yDEjT0qWn7KY2+kQTl8DqskIC8PVZMm3tMZyshSnbXbhS8G4HUEkTUs5ZBWLwkf8j7AEqBmCX/IcssWCTnFIJ+T7+rQpVhnpxmfevfFcJ/spMIOzvVjCqTzIBQ73oc+g8Y3DCK0AY1IPYr10jDCPsx+FQ51WoReDk7NFir3vSWB6SHF3kgg9KQ1QkM0wwHG75nECGw8r8iX2n1i2t/ouAVnHQDtv8p92OphpeDgg3ruQswwVpaePz+aOuujJp4=
    file:
      - out/ADK Wallet-*.AppImage
      - out/adk-wallet-*.tar.gz
      - out/ADK Wallet-*-i386.AppImage
      - out/adk-wallet-*-ia32.tar.gz
      - out/adk-wallet-*.i686.rpm
      - out/adk-wallet-*.x86_64.rpm
      - out/adk-wallet_*_i386.deb
      - out/adk-wallet_*_amd64.deb
    skip_cleanup: true
    file_glob: true
    on:
      repo: AidosKuneen/aidos-wallet
      tags: true
      all_branches: true
      condition: "$TRAVIS_OS_NAME == linux"

  - provider: releases
    api_key:
      secure: gZLVdbpEIbwPUSB6VRiqIczneke8J2P3RCAezeiSaYv15cXzZ5iX1Sd/o4LSu3YCKKhW9Qt8x0ZMHu9tw2+x8K7gjsBBidJvDwvzlDaiaJ57focGwhUPghg5qtElTverS6tC+oRJ67+coOvVI9iquNOKsdClMUZeOSlEDycxmT3f2SCyC3jLfGthcgrN08cw86L/w9dnoz6iE1E0EnUqs3fNsAb/ggqPXnwbTSQwIHJIgzep4k4jpqpgQOgcrs7MbhPoyxTpEPZwEOEVHIhFYImlUP/0iFJky5QqLOICPrVJ9gFRJQE3Om5Im8xZAvCcRUCkuzjSnit8x3kJz/hlavmHdTkNB1ALzmHGIpGI5frbzDF3vyJGJwG0OuAuKiY7VnyS44qin0JusPfOVgCSFLpTrYBO/pp7T0yjbZY8JUxp2yDEjT0qWn7KY2+kQTl8DqskIC8PVZMm3tMZyshSnbXbhS8G4HUEkTUs5ZBWLwkf8j7AEqBmCX/IcssWCTnFIJ+T7+rQpVhnpxmfevfFcJ/spMIOzvVjCqTzIBQ73oc+g8Y3DCK0AY1IPYr10jDCPsx+FQ51WoReDk7NFir3vSWB6SHF3kgg9KQ1QkM0wwHG75nECGw8r8iX2n1i2t/ouAVnHQDtv8p92OphpeDgg3ruQswwVpaePz+aOuujJp4=
    file:
      - out/ADK Wallet-*.dmg
    skip_cleanup: true
    file_glob: true
    on:
      repo: AidosKuneen/aidos-wallet
      tags: true
      all_branches: true
      condition: "$TRAVIS_OS_NAME == osx"
